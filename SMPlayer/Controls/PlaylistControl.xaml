<UserControl
    x:Class="SMPlayer.PlaylistControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Interactions="using:Microsoft.Xaml.Interactions.Core"
    xmlns:Interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:data="using:SMPlayer.Models"
    xmlns:local="using:SMPlayer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:triggers="using:SMPlayer.Triggers"
    x:Name="PlaylistController"
    Loaded="PlaylistController_Loaded"
    Loading="PlaylistController_Loading"
    mc:Ignorable="d">

    <UserControl.Resources>
        <Style x:Key="PlaylistListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        </Style>
    </UserControl.Resources>

    <ListView
        x:Name="SongsListView"
        Grid.Row="1"
        Padding="{x:Bind Padding}"
        AllowDrop="True"
        Background="{x:Bind Background}"
        CanDrag="True"
        CanDragItems="True"
        CanReorderItems="True"
        ContainerContentChanging="SongsListView_ContainerContentChanging"
        DragItemsCompleted="SongsListView_DragItemsCompleted"
        IsItemClickEnabled="True"
        ItemClick="SongsListView_ItemClick"
        ItemContainerStyle="{StaticResource PlaylistListViewItemStyle}"
        Opacity="{x:Bind Opacity}"
        ReorderMode="Enabled"
        SelectionMode="None">
        <ListView.ItemTemplate>
            <DataTemplate x:DataType="data:Music">
                <UserControl x:Name="PlaylistDataTemplateControl">
                    <Grid Background="Transparent">
                        <Grid.ContextFlyout>
                            <MenuFlyout Opening="OpenMusicMenuFlyout" />
                        </Grid.ContextFlyout>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="6*" />
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="5*" />
                            <ColumnDefinition Width="1*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal">
                            <FontIcon
                                x:Name="PlayingIcon"
                                Margin="0,0,16,0"
                                FontFamily="Segoe MDL2 Assets"
                                Foreground="{StaticResource SystemColorHighlightColor}"
                                Glyph="&#xE767;"
                                RelativePanel.AlignLeftWithPanel="True"
                                Visibility="{x:Bind IsPlaying, Converter={StaticResource VisibilityConverter}, Mode=OneWay}" />
                            <TextBlock
                                x:Name="TitleTextBlock"
                                Foreground="{x:Bind IsPlaying, Converter={StaticResource PlaylistRowColorConverter}, ConverterParameter=White, Mode=OneWay}"
                                Text="{x:Bind Name}" />
                        </StackPanel>
                        <TextBlock
                            x:Name="ArtistTextBlock"
                            Grid.Column="1"
                            Foreground="{x:Bind IsPlaying, Converter={StaticResource PlaylistRowColorConverter}, ConverterParameter=Gray, Mode=OneWay}"
                            Text="{x:Bind Artist}" />
                        <TextBlock
                            x:Name="AlbumTextBlock"
                            Grid.Column="2"
                            Foreground="{x:Bind IsPlaying, Converter={StaticResource PlaylistRowColorConverter}, ConverterParameter=Gray, Mode=OneWay}"
                            Text="{x:Bind Album}" />
                        <TextBlock
                            x:Name="DurationTextBlock"
                            Grid.Column="3"
                            HorizontalAlignment="Right"
                            Foreground="{x:Bind IsPlaying, Converter={StaticResource PlaylistRowColorConverter}, ConverterParameter=Gray, Mode=OneWay}"
                            Text="{x:Bind Duration, Converter={StaticResource MusicDurationConverter}}" />
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="WidthChange">
                                <VisualState x:Name="Width1000">
                                    <VisualState.StateTriggers>
                                        <triggers:ControlSizeTrigger MinWidth="1000" TargetElement="{x:Bind Path=PlaylistDataTemplateControl}" />
                                    </VisualState.StateTriggers>
                                </VisualState>
                                <VisualState x:Name="Width800">
                                    <VisualState.StateTriggers>
                                        <triggers:ControlSizeTrigger MinWidth="800" TargetElement="{x:Bind Path=PlaylistDataTemplateControl}" />
                                    </VisualState.StateTriggers>
                                    <VisualState.Setters>
                                        <Setter Target="AlbumTextBlock.Visibility" Value="Collapsed" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                    </Grid>
                </UserControl>
            </DataTemplate>
        </ListView.ItemTemplate>
    </ListView>
</UserControl>
